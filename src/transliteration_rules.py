# src/transliteration_rules.py

# هذا الملف يحتوي على قواعد النقحرة الأساسية لمشروع TSO.
# تم تصميمه ليكون قابلاً للتوسع واستيعاب التحديثات المستقبلية واللغات السامية المندثرة.
# ==============================================================================

import json
import os

# ==============================================================================
# 1. القواعد الافتراضية للوضع "البسيط" (Common Use)
#    تهدف هذه القواعد إلى احتواء عادات المستخدمين الشائعة في النقحرة اللاتينية
#    وتوجيههم بذكاء نحو تمثيل TSO المفضل.
# ==============================================================================

BASIC_TRANSLITERATION_MAP = {
    'ا': 'a', 'ب': 'b', 'ت': 't', 'ث': 'th', 'ج': 'j',
    'ح': 'h', 'خ': 'kh', 'د': 'd', 'ذ': 'dh', 'ر': 'r',
    'ز': 'z', 'س': 's', 'ش': 'sh', 'ص': 's', 'ض': 'd',
    'ط': 't', 'ظ': 'dh', 'ع': 'a', 'غ': 'gh', 'ف': 'f',
    'ق': 'q', 'ك': 'k', 'ل': 'l', 'م': 'm', 'ن': 'n',
    'ه': 'h', 'و': 'w', 'ي': 'y', 'ء': 'a', 'ى': 'a',
    'ة': 'a', 'أ': 'a', 'إ': 'i', 'آ': 'aa', 'ؤ': 'u',
    'ئ': 'i',

    # التشكيل والحركات (عادة لا تنقحر في الوضع البسيط، أو تظهر كمدود)
    'َ': '', 'ُ': '', 'ِ': '', 'ً': 'an', 'ٌ': 'un', 'ٍ': 'in',
    'ْ': '', 'ّ': '',

    # علامات الترقيم والمسافات
    ' ': ' ', '.': '.', ',': ',', ';': ';', ':': ':',
    '!': '!', '?': '?', '(': '(', ')': ')', '[': '[',
    ']': ']', '{': '{', '}': '}', '-': '-', '_': '_',
    '/': '/', '\\': '\\', '&': '&', '@': '@', '#': '#',
    '$': '$', '%': '%', '^': '^', '*': '*', '+': '+',
    '=': '=', '<': '<', '>': '>', '|': '|', '`': '`',
    '~': '~', '،': ',', '؛': ';', '؟': '?', 'ـ': '-',
    'ٰ': '', # ألف خنجرية
}

REVERSE_BASIC_TRANSLITERATION_MAP = {
    'a': 'ا', 'b': 'ب', 't': 'ت', 'th': 'ث', 'j': 'ج',
    'h': 'ح', 'kh': 'خ', 'd': 'د', 'dh': 'ذ', 'r': 'ر',
    'z': 'ز', 's': 'س', 'sh': 'ش', 'gh': 'غ', 'f': 'ف',
    'q': 'ق', 'k': 'ك', 'l': 'ل', 'm': 'م', 'n': 'ن',
    'w': 'و', 'y': 'ي', 'an': 'اً', 'un': 'ٌ', 'in': 'ٍ',
    'aa': 'آ',
}

# ==============================================================================
# 2. القواعد الأكاديمية (Academic Transliteration)
#    تستخدم رموزاً أكثر دقة، بما في ذلك رموز IPA أو رموز خاصة شائعة في
#    الدراسات السامية.
# ==============================================================================

ACADEMIC_TRANSLITERATION_MAP = {
    'ا': 'a', 'ب': 'b', 'ت': 't', 'ث': 'ṯ', 'ج': 'j',
    'ح': 'ḥ', 'خ': 'ḫ', 'د': 'd', 'ذ': 'ḏ', 'ر': 'r',
    'ز': 'z', 'س': 's', 'ش': 'š', 'ص': 'ṣ', 'ض': 'ḍ',
    'ط': 'ṭ', 'ظ': 'ẓ', 'ع': 'ɛ', # استخدام إبسيلون (epsilon)
    'غ': 'ġ', 'ف': 'f', 'ق': 'q', 'ك': 'k', 'ل': 'l',
    'م': 'm', 'ن': 'n', 'ه': 'h', 'و': 'w', 'ي': 'y',
    'ء': 'ʾ', # glottal stop
    'ى': 'ā', # ألف مقصورة كألف مد
    'ة': 'h', # أو t إذا كانت في حالة إضافة (مثل -at)
    'أ': 'ʾa', 'إ': 'ʾi', 'آ': 'ʾā', 'ؤ': 'ʾu', 'ئ': 'ʾi',

    # الحركات والتشكيل (تمثل في الوضع الأكاديمي)
    'َ': 'a', 'ُ': 'u', 'ِ': 'i', 'ً': 'an', 'ٌ': 'un', 'ٍ': 'in',
    'ْ': '°', # سكون (يمكن استخدام رموز أخرى مثل ∅)
    'ّ': '˜', # شدة (يمكن استخدام رموز أخرى مثل ː)

    # المدود (تمثيلها كحرف مد طويل)
    'ا': 'ā', # ألف المد
    'و': 'ū', # واو المد
    'ي': 'ī', # ياء المد

    # علامات الترقيم والمسافات (كما هي)
    ' ': ' ', '.': '.', ',': ',', ';': ';', ':': ':',
    '!': '!', '?': '?', '(': '(', ')': ')', '[': '[',
    ']': ']', '{': '{', '}': '}','-': '-', '_': '_',
    '/': '/', '\\': '\\', '&': '&', '@': '@', '#': '#',
    '$': '$', '%': '%', '^': '^', '*': '*', '+': '+',
    '=': '=', '<': '<', '>': '>', '|': '|', '`': '`',
    '~': '~', '،': ',', '؛': ';', '؟': '?', 'ـ': '-',
    'ٰ': 'ā', # ألف خنجرية كألف مد
}

# ==============================================================================
# 3. قواميس التحويل العكسي (من اللاتيني إلى العربي/السامي)
#    هذه القواميس ضرورية للتحويل من النقحرة اللاتينية إلى الأبجديات الأصلية.
#    تتطلب معالجة دقيقة للتعامل مع الغموض والأحرف المركبة.
#    ملاحظة: بناء القواميس العكسية أكثر تعقيداً لأنه قد يكون هناك أكثر من حرف لاتيني
#    يمثل حرفاً عربياً واحداً (مثل 's' لـ 'س' و 'ص').
#    سنقوم ببناء هذه القواميس بشكل يسمح بالتعامل مع الأحرف المركبة أولاً
#    (مثل 'sh' قبل 's') ومعالجة الغموض في transliteration_engine.py.
# ==============================================================================

REVERSE_ACADEMIC_TRANSLITERATION_MAP = {
    'a': 'ا', 'b': 'ب', 't': 'ت', 'ṯ': 'ث', 'j': 'ج',
    'ḥ': 'ح', 'ḫ': 'خ', 'd': 'د', 'ḏ': 'ذ', 'r': 'ر',
    'z': 'ز', 'س': 'س', 'š': 'ش', 'ṣ': 'ص', 'ḍ': 'ض',
    'ṭ': 'ط', 'ẓ': 'ظ', 'ɛ': 'ع', 'ġ': 'غ', 'f': 'ف',
    'q': 'ق', 'k': 'ك', 'l': 'ل', 'm': 'م', 'n': 'ن',
    'h': 'ه', 'w': 'و', 'y': 'ي', 'ʾ': 'ء', 'ā': 'ا',
    'ū': 'و', 'ī': 'ي', 'an': 'اً', 'un': 'ٌ', 'in': 'ٍ',
    'ʾa': 'أ', 'ʾi': 'إ', 'ʾā': 'آ', 'ʾu': 'ؤ', 'ʾi': 'ئ',
    '°': 'ْ', '˜': 'ّ',
    'ʕ': 'ع', # رمز العين كما اقترحت
    'ʿ': 'ع', # رمز العين الأكاديمي الشائع
    'kh': 'خ', # تمثيل الخاء الشائع
    'x': 'خ', # تمثيل الخاء IPA
    'th': 'ث', # تمثيل الثاء الشائع
    'dh': 'ذ', # تمثيل الذال الشائع
    'sh': 'ش', # تمثيل الشين الشائع
    'gh': 'غ', # تمثيل الغين الشائع
}


# ==============================================================================
# 4. خيارات إضافية لرموز IPA للمستخدم (يمكن تفعيلها كملف شخصي مخصص)
#    هذه الخيارات توفر تمثيلات دقيقة للأصوات غير الموجودة على لوحة مفاتيح QWERTY
#    ويمكن للمستخدم اختيار تفعيلها في وضعه الأكاديمي أو تخصيصها.
# ==============================================================================

IPA_EXTENDED_OPTIONS = {
    # حرف العين 'ع'
    'ع': {
        'default': 'ɛ', # التمثيل الافتراضي في الوضع الأكاديمي
        'options': ['ʕ', 'ʿ'] # خيارات IPA إضافية يمكن للمستخدم تفعيلها
    },
    # حرف الثاء 'ث' (بالإضافة إلى ṯ)
    'ث': {
        'default': 'ṯ',
        'options': ['θ'] # Theta from IPA
    },
    # حرف الخاء 'خ'
    'خ': {
        'default': 'ḫ', # التمثيل الأكاديمي الافتراضي
        'options': ['x'] # 'x' for velar fricative
    },
    # الأحرف المفخمة (الصاد، الضاد، الطاء، الظاء)
    'ص': {
        'default': 'ṣ',
        'options': ['sˤ'] # s with pharyngealization diacritic
    },
    'ض': {
        'default': 'ḍ',
        'options': ['dˤ'] # d with pharyngealization diacritic
    },
    'ط': {
        'default': 'ṭ',
        'options': ['tˤ'] # t with pharyngealization diacritic
    },
    'ظ': {
        'default': 'ẓ',
        'options': ['ðˤ'] # eth with pharyngealization diacritic
    },
    # مخارج العلة والمدود (التعامل معها يتطلب معالجة سياقية في Engine)
    # يمكن تعريفها هنا كرموز يمكن أن يختارها المستخدم لتمثيل المدود
    'ا_مد': { # ألف المد
        'default': 'ā',
        'options': ['aː'] # a with length mark
    },
    'و_مد': { # واو المد
        'default': 'ū',
        'options': ['uː'] # u with length mark
    },
    'ي_مد': { # ياء المد
        'default': 'ī',
        'options': ['iː'] # i with length mark
    },
    # الهمزة 'ء'
    'ء': {
        'default': 'ʾ', # glottal stop
        'options': ['ʔ'] # IPA glottal stop
    },
    # الحركات القصيرة (يمكن إضافة تمثيل IPA لها إذا كان مطلوباً، مثل ə للشوا)
    'َ': { # فتحة
        'default': 'a',
        'options': ['æ', 'ɐ'] # near-open front unrounded vowel, near-open central vowel
    },
    'ُ': { # ضمة
        'default': 'u',
        'options': ['ʊ', 'o̞'] # near-close near-back rounded vowel, mid central rounded vowel
    },
    'ِ': { # كسرة
        'default': 'i',
        'options': ['ɪ', 'e̞'] # near-close near-front unrounded vowel, mid central unrounded vowel
    },
    # الشدة (تكرار الحرف)
    'ّ': {
        'default': '˜', # علامة التلدة
        'options': ['ː'] # علامة طول الصوت في IPA
    },
    # السكون
    'ْ': {
        'default': '°', # علامة الدرجة
        'options': ['∅'] # رمز IPA لغياب الصوت
    }
}

# ==============================================================================
# 5. الأحرف السامية الإضافية (سيتم توسيعها لاحقاً بناءً على الأبحاث واللغات المندثرة)
#    هذا القسم يوضح بنية إضافة حروف من أبجديات سامية أخرى (مثل الفينيقية، الآرامية، العبرية القديمة).
#    سيتم استخدامها لتوسيع نطاق النقحرة لتشمل نصوصاً تاريخية ولغات مندثرة.
# ==============================================================================

SEMITIC_ADDITIONAL_CHARS = {
    # مثال: الألف الفينيقية
    '𐤀': {'latin': 'ʾ', 'description': 'Phoenician Aleph (Glottal Stop)'},
    # مثال: الحيت الفينيقية
    '𐤇': {'latin': 'ḥ', 'description': 'Phoenician Heth (Voiceless Pharyngeal Fricative)'},
    # مثال: العين الفينيقية
    '𐤏': {'latin': 'ʿ', 'description': 'Phoenician Ayin (Voiced Pharyngeal Fricative)'},
    # ... يمكن إضافة المزيد من الأحرف من أبجديات أخرى ...
}


# ==============================================================================
# 6. وظيفة تحميل القواعد المخصصة (Custom Profile Rules)
#    تسمح للمستخدمين بتعريف قواعد النقحرة الخاصة بهم عبر ملف JSON.
# ==============================================================================

def load_custom_profile_rules(profile_path):
    """
    تحميل قواعد النقحرة المخصصة من ملف JSON.
    يتوقع الملف JSON أن يحتوي على مفتاحين: "to_latin_map" و "from_latin_map".
    """
    if not os.path.exists(profile_path):
        print(f"خطأ: ملف التعريف المخصص غير موجود: {profile_path}")
        return {}, {}

    try:
        with open(profile_path, 'r', encoding='utf-8') as f:
            profile_data = json.load(f)

        # التأكد من وجود المفاتيح المتوقعة
        to_latin_map = profile_data.get('to_latin_map', {})
        from_latin_map = profile_data.get('from_latin_map', {})

        return to_latin_map, from_latin_map

    except json.JSONDecodeError:
        print(f"خطأ: ملف '{profile_path}' ليس JSON صالحاً.")
        return {}, {}
    except Exception as e:
        print(f"حدث خطأ غير متوقع أثناء تحميل الملف الشخصي: {e}")
        return {}, {}
